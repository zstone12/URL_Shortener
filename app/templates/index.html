{% extends 'base.html' %}
{% block css %} {% endblock %}
{% block context %}
    <ul class="nav nav-pills " id="nav">
        <li role="presentation" class="act active"><a href="#">创建短链</a></li>
        <li role="presentation"><a href="#">还原短链</a></li>
        <li role="presentation"><a href="#">查看统计信息</a></li>
        <li role="presentation"><a href="#">开放API权限</a></li>
    </ul>
    <div id="container">
        <section class="tab">
            <div class="form-group">
                <form action="#" id="shorten_form" onsubmit='return false'>
                    <input type="text" placeholder="请输入长网址" name="long_url">
                    <button onclick="shorten_url()"> 缩短网址</button>
                </form>
                <div id="shorten_result_div" style="width:25%;float:left;">
                </div>
            </div>
        </section>
        <section class="tab">
            <form action="#" id="lengthen_form" onsubmit='return false'>
                <input type="text" placeholder="请输入短网址" name="location">
                <button onclick="lengthen_url()">还原网址</button>
            </form>
            <div id="lengthen_result_div" style="width:25%;float:left;"></div>
        </section>
        <section class="tab"></section>
        <section class="tab"></section>

    </div>
    <script>
        window.onload = function () {
            var nav = document.getElementById('nav');
            var oNav = nav.getElementsByTagName('li');

            var container = document.getElementById('container');
            var oDiv = container.getElementsByClassName('tab');

            for (let i = 0; i < oNav.length; i++) {
                oNav[i].index = i;
                oNav[i].onclick = function () {
                    for (let i = 0; i < oNav.length; i++) {
                        oNav[i].className = '';
                        oDiv[i].style.display = "none";
                    }
                    this.className = 'act active';
                    oDiv[this.index].style.display = "block" //显示
                }
                for (let m = 1; m < oNav.length; m++) {
                    oNav[m].className = '';
                    oDiv[m].style.display = "none"; //不会被显示
                }
            }
        }
    </script>

    <script>
        function lengthen_url() {  //获取到按钮的点击事件

            $.ajax({
                url: "/lengthen/", //请求地址
                type: "POST",       //请求类型
                data: $('#lengthen_form').serialize(),
                success: function (data) {
                    var s = document.createElement("div");
                    var p = document.createElement("p");
                    if (data.status) {
                        alert('您查询的短网址不存在');
                    } else {
                        p.innerText = "原网址: " + data.long;
                        s.append(p);
                        $('#lengthen_result_div').empty();
                        $('#lengthen_result_div').append(s);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                }
            })
        }
    </script>
    <script>
        function shorten_url() {  //获取到按钮的点击事件
            $.ajax({
                url: "/shorten/", //请求地址
                type: "POST",       //请求类型
                data: $('#shorten_form').serialize(),
                success: function (data) {
                    {#var data1 = JSON.parse(data);#}
                    var s = document.createElement("div");
                    var p = document.createElement("p");
                    p.innerText = "原网址: " + data.long;

                    var p2 = document.createElement("p");
                    p2.innerText = "短网址: " + data.location;
                    p2.setAttribute("id", "short");

                    s.append(p2);
                    s.append(p);
                    $('#shorten_result_div').empty();
                    $('#shorten_result_div').append(s);


                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                }
            })
        }
    </script>
{% endblock %}